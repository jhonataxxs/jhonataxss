<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Loja de Peças de Computador</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Material+Icons" rel="stylesheet" />
<style>
  /* Reset / Global */
  * {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  html {
    font-size: 16px;
    font-family: 'Inter', sans-serif;
    color: #e0e0e0;
    background: linear-gradient(135deg, #1e2027 0%, #2f323a 100%);
    scroll-behavior: smooth;
  }
  body, #app {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  a {
    color: inherit;
    text-decoration: none;
  }
  button {
    font-family: inherit;
    cursor: pointer;
    background: none;
    border: none;
    outline-offset: 2px;
  }
  button:focus,
  a:focus {
    outline: 2px solid #6366F1;
    outline-offset: 2px;
  }

  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  ::-webkit-scrollbar-track {
    background: #2f323a;
  }
  ::-webkit-scrollbar-thumb {
    background: #6366f1;
    border-radius: 4px;
  }

  /* Container and Grid */
  #app {
    flex-grow: 1;
    display: grid;
    grid-template-rows: 64px 1fr 60px;
    grid-template-columns: 280px 1fr;
    grid-template-areas:
      "header header"
      "sidebar main"
      "footer footer";
    gap: 24px;
  }

  /* Responsive Layout */
  @media (max-width: 1023px) {
    #app {
      grid-template-columns: 1fr;
      grid-template-rows: 64px auto 60px;
      grid-template-areas:
        "header"
        "main"
        "footer";
    }
  }

  /* Header */
  header {
    grid-area: header;
    position: sticky;
    top: 0;
    height: 64px;
    background: rgba(99, 102, 241, 0.15);
    backdrop-filter: blur(20px);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 24px;
    box-shadow: 0 1px 10px rgb(99 102 241 / 0.3);
    z-index: 1000;
  }
  header .logo {
    font-weight: 700;
    font-size: clamp(1.5rem, 2vw, 2rem);
    color: #6366f1;
    letter-spacing: 0.05em;
    user-select: none;
  }
  header nav {
    display: flex;
    align-items: center;
    gap: 20px;
  }
  header nav button {
    display: none;
    color: #6366f1;
    font-size: 28px;
  }
  @media (max-width: 1023px) {
    header nav button.menu-toggle {
      display: block;
    }
  }
  header .cart-btn {
    position: relative;
    color: #6366f1;
    font-size: 28px;
  }
  header .cart-badge {
    position: absolute;
    top: -6px;
    right: -6px;
    min-width: 18px;
    height: 18px;
    padding: 0 6px;
    background: #ef4444;
    border-radius: 9999px;
    font-size: 12px;
    font-weight: 700;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
  }

  /* Sidebar */
  aside {
    grid-area: sidebar;
    background: rgba(99,102,241,0.12);
    backdrop-filter: blur(15px);
    border-radius: 16px;
    padding: 24px 20px;
    display: flex;
    flex-direction: column;
    gap: 24px;
    overflow-y: auto;
  }
  aside h2 {
    font-weight: 600;
    font-size: 1.25rem;
    color: #c7d2fe;
    margin-bottom: 12px;
    user-select: none;
  }
  aside ul {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  aside ul li button {
    color: #a5b4fc;
    font-weight: 500;
    font-size: 1rem;
    text-align: left;
    padding: 8px 12px;
    border-radius: 12px;
    transition: background-color 0.3s ease, color 0.3s ease;
    width: 100%;
  }
  aside ul li button.active,
  aside ul li button:hover {
    background: #6366f1;
    color: white;
  }
  @media (max-width: 1023px) {
    aside {
      position: fixed;
      top: 64px;
      left: 0;
      height: calc(100% - 64px);
      width: 280px;
      transform: translateX(-320px);
      transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      box-shadow: 4px 0 20px rgb(0 0 0 / 0.25);
      z-index: 1500;
    }
    aside.open {
      transform: translateX(0);
    }
  }

  /* Main Content */
  main {
    grid-area: main;
    padding: 16px 20px 48px;
    overflow-y: auto;
    min-height: calc(100vh - 64px - 60px);
    display: flex;
    flex-direction: column;
    gap: 36px;
  }

  /* Search */
  .search-box {
    max-width: 480px;
    position: relative;
    margin-bottom: 16px;
  }
  .search-box input {
    width: 100%;
    padding: 12px 44px 12px 16px;
    border-radius: 12px;
    border: none;
    font-size: 1rem;
    font-weight: 400;
    background: rgba(255 255 255 / 0.1);
    color: white;
    transition: background-color 0.3s ease;
  }
  .search-box input::placeholder {
    color: #c7d2fe99;
  }
  .search-box .material-icons {
    position: absolute;
    right: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: #a5b4fccc;
    font-size: 24px;
    pointer-events: none;
  }
  .search-box input:focus {
    background: rgba(255 255 255 / 0.15);
    outline: 2px solid #6366f1;
  }

  /* Products Grid */
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
  }
  .product-card {
    background: rgba(99,102,241,0.1);
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 4px 14px rgb(99 102 241 / 0.1);
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .product-card:hover,
  .product-card:focus-within {
    transform: translateY(-6px);
    box-shadow: 0 8px 28px rgb(99 102 241 / 0.35);
  }
  .product-img {
    width: 100%;
    aspect-ratio: 16 / 9;
    object-fit: cover;
    flex-shrink: 0;
  }
  .product-details {
    flex-grow: 1;
    padding: 16px 20px 28px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .product-title {
    font-weight: 700;
    font-size: 1.125rem;
    color: #e0e0ff;
    user-select: none;
  }
  .product-desc {
    font-weight: 400;
    font-size: 0.9rem;
    color: #bfc7f8;
    flex-grow: 1;
  }
  .product-price {
    font-weight: 700;
    font-size: 1.2rem;
    color: #6366f1;
  }
  .product-actions {
    margin-top: 6px;
    display: flex;
    justify-content: flex-end;
  }
  .product-add-btn {
    background: #6366f1;
    color: white;
    padding: 10px 22px;
    border-radius: 14px;
    font-weight: 600;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: background-color 0.3s ease;
  }
  .product-add-btn:hover,
  .product-add-btn:focus-visible {
    background: #4f46e5;
  }

  /* Cart Drawer */
  .cart-drawer {
    position: fixed;
    top: 64px;
    right: 0;
    width: 360px;
    max-width: 100vw;
    height: calc(100% - 64px);
    background: rgba(25, 25, 38, 0.95);
    backdrop-filter: blur(20px);
    box-shadow: -4px 0 30px rgb(0 0 0 / 0.8);
    transform: translateX(400px);
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    z-index: 2000;
    display: flex;
    flex-direction: column;
    border-radius: 12px 0 0 12px;
  }
  .cart-drawer.open {
    transform: translateX(0);
  }
  .cart-header {
    padding: 20px;
    border-bottom: 1px solid #444;
    font-weight: 700;
    font-size: 1.4rem;
    color: #6366f1;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .cart-close {
    background: transparent;
    border: none;
    color: #6366f1;
    font-size: 28px;
    cursor: pointer;
  }
  .cart-items {
    flex-grow: 1;
    overflow-y: auto;
    padding: 16px 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  .cart-item {
    display: flex;
    gap: 16px;
    align-items: center;
  }
  .cart-item-image {
    width: 56px;
    height: 56px;
    border-radius: 12px;
    object-fit: cover;
    flex-shrink: 0;
    background: #444;
  }
  .cart-item-info {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
    color: #e0e0ff;
  }
  .cart-item-name {
    font-weight: 600;
    font-size: 1rem;
    user-select: none;
  }
  .cart-item-price {
    font-weight: 500;
    font-size: 0.9rem;
    color: #9fa6e8;
  }
  .cart-item-controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }
  .cart-qty {
    display: flex;
    align-items: center;
    gap: 8px;
    background: #3b3e58;
    border-radius: 10px;
    padding: 4px 8px;
  }
  .cart-qty button {
    font-size: 20px;
    color: #c7d2fe;
    user-select: none;
    line-height: 1;
  }
  .cart-qty span {
    width: 22px;
    text-align: center;
    font-weight: 600;
    color: #e0e0ff;
  }
  .cart-remove-btn {
    background: transparent;
    color: #ef4444;
    font-size: 22px;
    cursor: pointer;
    user-select: none;
  }
  .cart-footer {
    padding: 20px;
    border-top: 1px solid #444;
    color: #c7d2feaa;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    font-size: 1.15rem;
  }
  .cart-checkout-btn {
    background: #6366f1;
    color: white;
    padding: 14px 0;
    font-weight: 700;
    font-size: 1.15rem;
    border-radius: 16px;
    width: 100%;
    margin-top: 12px;
    transition: background-color 0.3s ease;
  }
  .cart-checkout-btn:hover,
  .cart-checkout-btn:focus-visible {
    background: #4f46e5;
  }
  @media (max-width: 767px) {
    .cart-drawer {
      width: 100vw;
      border-radius: 0;
      max-width: none;
    }
  }

  /* Footer */
  footer {
    grid-area: footer;
    background: rgba(99, 102, 241, 0.12);
    backdrop-filter: blur(15px);
    text-align: center;
    padding: 16px 12px;
    font-weight: 500;
    color: #9ca3af;
    font-size: 0.9rem;
    user-select: none;
    box-shadow: inset 0 1px 0 rgb(255 255 255 / 0.1);
  }
  footer a {
    color: #6366f1;
    font-weight: 700;
  }
</style>
</head>
<body>
<div id="app" role="application" aria-label="Loja de Peças de Computador">

  <header>
    <div class="logo" tabindex="0" aria-label="Marca da loja LojaTech">LojaTech</div>
    <nav>
      <button class="material-icons menu-toggle" aria-label="Abrir menu de navegação" aria-expanded="false" aria-controls="sidebar">menu</button>
      <button class="material-icons cart-btn" aria-label="Abrir carrinho de compras" aria-haspopup="dialog" aria-controls="cart-drawer" aria-expanded="false">shopping_cart
        <span class="cart-badge" aria-live="polite" aria-atomic="true">0</span>
      </button>
    </nav>
  </header>

  <aside id="sidebar" aria-label="Filtro de categorias e navegação">
    <h2>Categorias</h2>
    <ul>
      <li><button type="button" class="category-btn active" data-category="all" aria-pressed="true">Todas</button></li>
      <li><button type="button" class="category-btn" data-category="cpu" aria-pressed="false">CPU</button></li>
      <li><button type="button" class="category-btn" data-category="gpu" aria-pressed="false">GPU</button></li>
      <li><button type="button" class="category-btn" data-category="memoria" aria-pressed="false">Memória</button></li>
      <li><button type="button" class="category-btn" data-category="armazenamento" aria-pressed="false">Armazenamento</button></li>
      <li><button type="button" class="category-btn" data-category="placa-mae" aria-pressed="false">Placa Mãe</button></li>
    </ul>
  </aside>

  <main>
    <section aria-label="Busca de produtos" class="search-box">
      <input type="search" id="search-input" aria-label="Buscar produtos" placeholder="Buscar peças de computador..." autocomplete="off" />
      <span class="material-icons">search</span>
    </section>

    <section aria-label="Catálogo de produtos" class="products-grid" id="products-grid" tabindex="0" role="list" aria-live="polite" aria-relevant="additions removals">
      <!-- Produtos carregados via JS -->
    </section>
  </main>

  <div role="dialog" id="cart-drawer" class="cart-drawer" aria-modal="true" aria-label="Carrinho de compras" tabindex="-1" aria-hidden="true">
    <header class="cart-header">
      <span>Carrinho</span>
      <button type="button" class="cart-close" aria-label="Fechar carrinho">close</button>
    </header>
    <section class="cart-items" id="cart-items" tabindex="0" aria-live="polite" aria-relevant="additions removals">
      <!-- Itens do carrinho via JS -->
    </section>
    <footer class="cart-footer">
      <div>Total:</div><div id="cart-total">R$ 0,00</div>
    </footer>
    <button type="button" class="cart-checkout-btn" disabled aria-disabled="true">Finalizar Compra</button>
  </div>

  <footer>
    &copy; 2024 LojaTech - Peças para Computadores | <a href="https://github.com/" target="_blank" rel="noopener noreferrer">GitHub</a>
  </footer>
</div>

<script>
  'use strict';

  // Dados de produtos dummy
  const products = [
    { id: 'p1', title: 'Processador Ryzen 9 5900X', desc: '12 núcleos, 24 threads, alta performance.', price: 2499.9, category:'cpu', image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/855a2056-a10d-4eaa-a0d1-3cea1c15b042.png' },
    { id: 'p2', title: 'Placa de Vídeo RTX 3080', desc: '10GB GDDR6X, Ray Tracing, alta performance.', price: 4799.99, category:'gpu', image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/fd15411d-224c-4f09-b111-24ed839b3502.png' },
    { id: 'p3', title: 'Memória RAM 16GB DDR4 3200MHz', desc: 'Kit com 2x8GB, baixa latência.', price: 699.5, category:'memoria', image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/72444acd-cba3-49b1-94a1-c95d14e58be6.png' },
    { id: 'p4', title: 'SSD NVMe 1TB', desc: 'Leitura 3500MB/s, gravação 3000MB/s.', price: 849.99, category:'armazenamento', image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/215c281a-be3e-4f68-9285-afe474867053.png' },
    { id: 'p5', title: 'Placa Mãe ASUS Prime X570', desc: 'Suporte AMD Ryzen, DDR4, USB 3.2.', price: 1399.9, category:'placa-mae', image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/56d559d7-9a73-4626-a623-ab4534d76066.png' },
    { id: 'p6', title: 'Fonte 650W 80 Plus Gold', desc: 'Alta eficiência, modular.', price: 499.0, category:'placa-mae', image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/f41ebc6c-7681-4703-b3b4-36d8dbf6f828.png'+encodeURIComponent('80PlusGold') },
    { id: 'p7', title: 'Cooler CPU RGB', desc: 'Iluminação LED, alto desempenho.', price: 199.9, category:'cpu', image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/3c056c1e-7b5e-4080-b615-7766efb0f260.png' },
    { id: 'p8', title: 'Placa de Vídeo GTX 1660', desc: '6GB GDDR5, bom custo-benefício.', price: 1299.9, category:'gpu', image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/aded7c3b-7597-4d05-bb1c-b5485694e13f.png' }
  ];

  // Estado global da aplicação
  let state = {
    filteredCategory: 'all',
    searchQuery: '',
    cart: JSON.parse(localStorage.getItem('cart')) || {},
    isSidebarOpen: false,
    isCartOpen: false
  };

  // DOM Elementos essenciais
  const productsGrid = document.getElementById('products-grid');
  const categoryButtons = document.querySelectorAll('.category-btn');
  const searchInput = document.getElementById('search-input');
  const cartDrawer = document.getElementById('cart-drawer');
  const cartItemsContainer = document.getElementById('cart-items');
  const cartTotal = document.getElementById('cart-total');
  const cartBadge = document.querySelector('.cart-badge');
  const cartBtn = document.querySelector('.cart-btn');
  const cartCloseBtn = document.querySelector('.cart-close');
  const cartCheckoutBtn = document.querySelector('.cart-checkout-btn');
  const menuToggleBtn = document.querySelector('.menu-toggle');
  const sidebar = document.querySelector('aside');

  // Atualiza UI do carrinho (badge, itens, total)
  function updateCartUI() {
    // Atualiza badge
    const totalQuantity = Object.values(state.cart).reduce((acc, item) => acc + item.qty, 0);
    cartBadge.textContent = totalQuantity;
    cartBadge.style.display = totalQuantity > 0 ? 'flex' : 'none';
    cartBtn.setAttribute('aria-label', `Abrir carrinho de compras com ${totalQuantity} ${totalQuantity === 1 ? 'item' : 'itens'}`);

    // Limpa itens existentes
    cartItemsContainer.innerHTML = '';
    if (totalQuantity === 0) {
      const emptyMsg = document.createElement('p');
      emptyMsg.textContent = 'Seu carrinho está vazio.';
      emptyMsg.style.color = '#9ca3af';
      cartItemsContainer.appendChild(emptyMsg);
      cartCheckoutBtn.disabled = true;
      cartCheckoutBtn.setAttribute('aria-disabled', 'true');
      cartTotal.textContent = 'R$ 0,00';
      return;
    }

    // Renderiza itens do carrinho
    let totalValue = 0;
    for (const [id, itemData] of Object.entries(state.cart)) {
      const product = products.find(p => p.id === id);
      if (!product) continue;
      const itemTotal = product.price * itemData.qty;
      totalValue += itemTotal;

      const cartItem = document.createElement('article');
      cartItem.className = 'cart-item';
      cartItem.setAttribute('role', 'listitem');

      cartItem.innerHTML = `
        <img class="cart-item-image" src="${product.image}" alt="Imagem do produto ${product.title}" loading="lazy" width="56" height="56" />
        <div class="cart-item-info">
          <div class="cart-item-name">${product.title}</div>
          <div class="cart-item-price">R$ ${itemTotal.toFixed(2).replace('.', ',')}</div>
        </div>
        <div class="cart-item-controls">
          <div class="cart-qty" role="group" aria-label="Quantidade para ${product.title}">
            <button type="button" aria-label="Diminuir quantidade" data-product-id="${id}" class="qty-decrease">−</button>
            <span aria-live="polite" aria-atomic="true">${itemData.qty}</span>
            <button type="button" aria-label="Aumentar quantidade" data-product-id="${id}" class="qty-increase">+</button>
          </div>
          <button type="button" aria-label="Remover ${product.title} do carrinho" data-product-id="${id}" class="cart-remove-btn">close</button>
        </div>
      `;
      cartItemsContainer.appendChild(cartItem);
    }
    cartTotal.textContent = `R$ ${totalValue.toFixed(2).replace('.', ',')}`;
    cartCheckoutBtn.disabled = false;
    cartCheckoutBtn.setAttribute('aria-disabled', 'false');
  }

  // Salva estado do carrinho no localStorage
  function saveCart() {
    localStorage.setItem('cart', JSON.stringify(state.cart));
  }

  // Adiciona produto no carrinho
  function addToCart(productId) {
    if (!state.cart[productId]) {
      state.cart[productId] = { qty: 1 };
    } else {
      state.cart[productId].qty++;
    }
    saveCart();
    updateCartUI();
    showToast(`"${products.find(p => p.id === productId).title}" adicionado ao carrinho`);
  }

  // Remove produto do carrinho
  function removeFromCart(productId) {
    delete state.cart[productId];
    saveCart();
    updateCartUI();
  }

  // Atualiza quantidade do carrinho
  function updateCartQuantity(productId, amount) {
    if (!state.cart[productId]) return;
    state.cart[productId].qty += amount;
    if (state.cart[productId].qty <= 0) {
      removeFromCart(productId);
    } else {
      saveCart();
    }
    updateCartUI();
  }

  // Renderiza produtos conforme filtros (categoria e pesquisa)
  function renderProducts() {
    const query = state.searchQuery.toLowerCase();
    const category = state.filteredCategory;

    const filtered = products.filter(p => {
      const matchesCategory = category === 'all' || p.category === category;
      const matchesSearch = p.title.toLowerCase().includes(query) || p.desc.toLowerCase().includes(query);
      return matchesCategory && matchesSearch;
    });

    productsGrid.innerHTML = '';
    if (filtered.length === 0) {
      const noResults = document.createElement('p');
      noResults.textContent = 'Nenhum produto encontrado.';
      noResults.style.color = '#c7d2fe';
      productsGrid.appendChild(noResults);
      return;
    }

    for (const p of filtered) {
      const card = document.createElement('article');
      card.className = 'product-card';
      card.setAttribute('role', 'listitem');
      card.setAttribute('tabindex', '0');
      card.innerHTML = `
        <img src="${p.image}" alt="Imagem do produto ${p.title}" class="product-img" loading="lazy" width="320" height="180"/>
        <div class="product-details">
          <h3 class="product-title">${highlightText(p.title, query)}</h3>
          <p class="product-desc">${highlightText(p.desc, query)}</p>
          <div class="product-price">R$ ${p.price.toFixed(2).replace('.', ',')}</div>
          <div class="product-actions">
            <button type="button" class="product-add-btn" aria-label="Adicionar ${p.title} ao carrinho">
              <span class="material-icons" aria-hidden="true">add_shopping_cart</span> Adicionar
            </button>
          </div>
        </div>
      `;
      // Adicionar evento ao botão
      card.querySelector('.product-add-btn').addEventListener('click', () => addToCart(p.id));
      productsGrid.appendChild(card);
    }
  }

  // Realça texto da busca
  function highlightText(text, query) {
    if (!query) return escapeHTML(text);
    const pattern = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
    return escapeHTML(text).replace(pattern, '<mark>$1</mark>');
  }
  // Escapa caracteres para html (prevenção XSS)
  function escapeHTML(str) {
    return str.replace(/[&<>"']/g, (match) => {
      return { '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[match];
    });
  }

  // Atualiza status dos botões da categoria
  function updateCategoryButtons() {
    categoryButtons.forEach(btn => {
      const isActive = btn.dataset.category === state.filteredCategory;
      btn.classList.toggle('active', isActive);
      btn.setAttribute('aria-pressed', isActive.toString());
    });
  }

  // Toast de feedback simples
  let toastTimeout;
  function showToast(message) {
    clearTimeout(toastTimeout);
    let toast = document.getElementById('toast-message');
    if (!toast) {
      toast = document.createElement('div');
      toast.id = 'toast-message';
      toast.setAttribute('aria-live', 'polite');
      toast.style = `
        position: fixed;
        bottom: 32px;
        left: 50%;
        transform: translateX(-50%);
        background: #6366f1;
        color: white;
        padding: 12px 24px;
        border-radius: 24px;
        font-weight: 600;
        box-shadow: 0 4px 12px rgb(99 102 241 / 0.6);
        font-size: 1rem;
        z-index: 9999;
      `;
      document.body.appendChild(toast);
    }
    toast.textContent = message;
    toast.style.opacity = '1';
    toastTimeout = setTimeout(() => {
      toast.style.opacity = '0';
    }, 3000);
  }

  // Toggle sidebar mobile menu
  function toggleSidebar() {
    const opened = sidebar.classList.toggle('open');
    menuToggleBtn.setAttribute('aria-expanded', opened.toString());
  }

  // Toggle cart drawer open/close
  function toggleCart(open) {
    const opening = open !== undefined ? open : !state.isCartOpen;
    state.isCartOpen = opening;
    cartDrawer.classList.toggle('open', opening);
    cartDrawer.setAttribute('aria-hidden', (!opening).toString());
    cartBtn.setAttribute('aria-expanded', opening.toString());
    if (opening) {
      cartDrawer.focus();
      document.body.style.overflow = 'hidden';
    } else {
      document.body.style.overflow = '';
      cartBtn.focus();
    }
  }

  // Eventos
  categoryButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      state.filteredCategory = btn.dataset.category;
      updateCategoryButtons();
      renderProducts();
    });
  });

  searchInput.addEventListener('input', (ev) => {
    state.searchQuery = ev.target.value;
    renderProducts();
  });

  cartBtn.addEventListener('click', () => toggleCart(true));
  cartCloseBtn.addEventListener('click', () => toggleCart(false));

  // Close sidebar or cart drawer with Escape key
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      if (state.isCartOpen) toggleCart(false);
      if (sidebar.classList.contains('open')) {
        sidebar.classList.remove('open');
        menuToggleBtn.setAttribute('aria-expanded', 'false');
      }
    }
  });

  // Increase / decrease qty in cart
  cartItemsContainer.addEventListener('click', e => {
    if (e.target.classList.contains('qty-increase')) {
      const id = e.target.dataset.productId;
      updateCartQuantity(id, +1);
    }
    else if (e.target.classList.contains('qty-decrease')) {
      const id = e.target.dataset.productId;
      updateCartQuantity(id, -1);
    }
    else if (e.target.classList.contains('cart-remove-btn')) {
      const id = e.target.dataset.productId;
      removeFromCart(id);
    }
  });

  // Checkout button feedback
  cartCheckoutBtn.addEventListener('click', () => {
    if (Object.keys(state.cart).length === 0) return;
    alert('Obrigado pela sua compra! Esta é uma simulação de checkout.');
    state.cart = {};
    saveCart();
    updateCartUI();
    toggleCart(false);
  });

  // Menu toggle mobile
  menuToggleBtn.addEventListener('click', () => toggleSidebar());

  // Inicialização
  updateCategoryButtons();
  renderProducts();
  updateCartUI();

</script>
</body>
</html>

